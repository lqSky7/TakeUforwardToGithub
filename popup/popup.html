<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>TakeUforwardToGithub</title>
        <link rel="stylesheet" href="popup.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
    </head>
    <body>
        <div class="container">
            <!-- Header Section -->
            <header class="header">
                <div class="logo-section">
                    <img
                        src="../assets/120.png"
                        alt="TakeUforwardToGithub"
                        class="logo"
                    />
                    <div class="title-section">
                        <h1>TakeUforward</h1>
                        <span class="subtitle">GitHub Bridge</span>
                    </div>
                </div>
                <div class="status-indicator" id="connection-status">
                    <div class="status-dot"></div>
                    <span class="status-text">Not Connected</span>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="config">
                    Configuration
                </button>
                <button class="tab-btn" data-tab="status">Status</button>
                <button class="tab-btn" data-tab="prediction">
                    Prediction
                </button>
                <button class="tab-btn" data-tab="help">Help</button>
            </nav>

            <!-- Configuration Tab -->
            <section class="tab-content active" id="config-tab">
                <form id="github-config-form" class="config-form">
                    <!-- Authentication Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">üîê</span>
                            Authentication
                        </h3>
                        <div class="form-group">
                            <label for="github-token" class="field-label">
                                Personal Access Token
                                <span class="required">*</span>
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="password"
                                    id="github-token"
                                    class="field-input"
                                    placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                                    required
                                />
                                <button
                                    type="button"
                                    class="toggle-password"
                                    id="toggle-token"
                                >
                                    <span class="toggle-icon">üëÅ</span>
                                </button>
                            </div>
                            <div class="field-help">
                                <a
                                    href="https://github.com/settings/tokens/new"
                                    target="_blank"
                                    class="help-link"
                                >
                                    ‚Üí Generate new token
                                </a>
                                <span class="help-text"
                                    >Requires: repo, workflow permissions</span
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Repository Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">üìÅ</span>
                            Repository
                        </h3>
                        <div class="form-row">
                            <div class="form-group flex-1">
                                <label for="github-owner" class="field-label">
                                    Username
                                    <span class="required">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="github-owner"
                                    class="field-input"
                                    placeholder="your-username"
                                    required
                                />
                            </div>
                            <div class="form-group flex-1">
                                <label for="github-repo" class="field-label">
                                    Repository
                                    <span class="required">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="github-repo"
                                    class="field-input"
                                    placeholder="my-solutions"
                                    required
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="github-branch" class="field-label"
                                >Branch</label
                            >
                            <select id="github-branch" class="field-select">
                                <option value="main">main</option>
                                <option value="master">master</option>
                                <option value="solutions">solutions</option>
                                <option value="custom">Custom...</option>
                            </select>
                            <input
                                type="text"
                                id="custom-branch"
                                class="field-input hidden"
                                placeholder="feature/new-branch"
                            />
                        </div>
                    </div>

                    <!-- Notion Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="section-icon">üìù</span>
                            Notion Integration
                        </h3>
                        <div class="form-group">
                            <label class="toggle-wrapper">
                                <input
                                    type="checkbox"
                                    id="notion-enabled"
                                    class="toggle-input"
                                />
                                <span class="toggle-slider"></span>
                                <span class="toggle-label"
                                    >Enable Notion tracking</span
                                >
                            </label>
                        </div>
                        <div id="notion-config" class="notion-config hidden">
                            <div class="form-group">
                                <label for="notion-token" class="field-label">
                                    Integration Token
                                    <span class="required">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input
                                        type="password"
                                        id="notion-token"
                                        class="field-input"
                                        placeholder="ntn_xxxxxxxxxxxxxxxxxxxx"
                                    />
                                    <button
                                        type="button"
                                        class="toggle-password"
                                        id="toggle-notion-token"
                                    >
                                        <span class="toggle-icon">üëÅ</span>
                                    </button>
                                </div>
                                <div class="field-help">
                                    <a
                                        href="https://www.notion.so/my-integrations"
                                        target="_blank"
                                        class="help-link"
                                    >
                                        ‚Üí Create new integration
                                    </a>
                                    <a
                                        href="https://developers.notion.com/docs/create-a-notion-integration"
                                        target="_blank"
                                        class="help-link"
                                    >
                                        ‚Üí Setup guide
                                    </a>
                                    <span class="help-text"
                                        >Use the token from your
                                        integration</span
                                    >
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notion-page" class="field-label">
                                    Page Name
                                    <span class="required">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="notion-page"
                                    class="field-input"
                                    placeholder="TakeUforward Tracker"
                                />
                                <div class="field-help">
                                    <span class="help-text"
                                        >Must match the exact page name in
                                        Notion</span
                                    >
                                </div>
                            </div>
                            <div class="form-group">
                                <button
                                    type="button"
                                    class="btn btn-secondary"
                                    id="create-notion-database"
                                >
                                    <span class="btn-icon">üìù</span>
                                    Create Database
                                </button>
                                <div class="field-help">
                                    <span class="help-text"
                                        >Click to create the tracking database
                                        in Notion</span
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Validation Messages -->
                    <div
                        class="validation-section"
                        id="validation-messages"
                    ></div>

                    <!-- Action Buttons -->
                    <div class="action-section">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            id="test-connection"
                        >
                            <span class="btn-icon">üîó</span>
                            Test Connection
                        </button>
                        <button
                            type="submit"
                            class="btn btn-primary"
                            id="save-config"
                        >
                            <span class="btn-icon">üíæ</span>
                            Save Configuration
                        </button>
                    </div>
                </form>
            </section>

            <!-- Status Tab -->
            <section class="tab-content" id="status-tab">
                <div class="status-section">
                    <div class="status-card">
                        <h3 class="status-title">Connection Status</h3>
                        <div class="status-details" id="status-details">
                            <div class="status-item">
                                <span class="status-label">GitHub API:</span>
                                <span class="status-value" id="api-status"
                                    >Unknown</span
                                >
                            </div>
                            <div class="status-item">
                                <span class="status-label">Repository:</span>
                                <span class="status-value" id="repo-status"
                                    >Unknown</span
                                >
                            </div>
                            <div class="status-item">
                                <span class="status-label">Last Sync:</span>
                                <span class="status-value" id="last-sync"
                                    >Never</span
                                >
                            </div>
                            <div class="status-item">
                                <span class="status-label">Notion:</span>
                                <span class="status-value" id="notion-status"
                                    >Not configured</span
                                >
                            </div>
                        </div>
                    </div>

                    <div class="stats-section">
                        <h3 class="stats-title">Analytics</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value" id="commit-count"
                                    >-</span
                                >
                                <span class="stat-label">Total Commits</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Prediction Tab -->
            <section class="tab-content" id="prediction-tab">
                <div class="prediction-container">
                    <!-- Prediction Controls -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span class="title-icon">üéØ</span>
                            Smart Task Scheduler
                        </h3>
                        <div class="prediction-controls">
                            <div class="control-group">
                                <label class="form-label">
                                    <span class="label-text"
                                        >Tasks to Schedule</span
                                    >
                                </label>
                                <input
                                    type="number"
                                    class="form-input"
                                    id="target-count"
                                    value="10"
                                    min="1"
                                    max="50"
                                    step="1"
                                />
                            </div>
                            <div class="control-group">
                                <label class="form-label">
                                    <span class="label-text">Focus Mode</span>
                                </label>
                                <select class="form-select" id="focus-mode">
                                    <option value="0">
                                        Only Revise (100% revision)
                                    </option>
                                    <option value="1" selected>
                                        Focus Revision (70% revision, 30% new)
                                    </option>
                                    <option value="2">
                                        Focus New (30% revision, 70% new)
                                    </option>
                                    <option value="3">
                                        Only New (100% new)
                                    </option>
                                </select>
                                <div
                                    class="focus-description"
                                    id="focus-description"
                                >
                                    70% revision problems, 30% new problems
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="form-label">
                                    <span class="label-text">Grandparent Filter</span>
                                </label>
                                <select class="form-select" id="grandparent-filter" multiple size="3">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="form-label">
                                    <span class="label-text">Parent Topic Filter</span>
                                </label>
                                <select class="form-select" id="parent-filter">
                                    <option value="">All Topics</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <div class="button-group">
                                    <button
                                        type="button"
                                        class="btn btn-primary"
                                        id="generate-schedule"
                                    >
                                        <span class="btn-icon">üîÆ</span>
                                        Generate Schedule
                                    </button>
                                    <button
                                        type="button"
                                        class="btn btn-secondary"
                                        id="clear-schedule"
                                        title="Clear saved schedule"
                                    >
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        Clear Schedule
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Section -->
                    <div
                        class="form-section"
                        id="prediction-stats"
                        style="display: none"
                    >
                        <h3 class="section-title">
                            <span class="title-icon">üìä</span>
                            Statistics
                        </h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="total-tasks">
                                    -
                                </div>
                                <div class="stat-label">Total</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="active-tasks">
                                    -
                                </div>
                                <div class="stat-label">Active</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="solved-tasks">
                                    -
                                </div>
                                <div class="stat-label">Solved</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="unsolved-tasks">
                                    -
                                </div>
                                <div class="stat-label">Unsolved</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="ignored-tasks">
                                    -
                                </div>
                                <div class="stat-label">Ignored</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="scheduled-count">
                                    -
                                </div>
                                <div class="stat-label">Scheduled</div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div
                        class="form-section"
                        id="prediction-results"
                        style="display: none"
                    >
                        <h3 class="section-title">
                            <span class="title-icon">üìã</span>
                            Today's Schedule
                            <span class="schedule-timestamp" id="schedule-timestamp"></span>
                        </h3>
                        <div class="task-schedule" id="task-list">
                            <!-- Tasks will be populated here -->
                        </div>
                        <div class="schedule-actions" style="margin-top: 12px">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                id="manage-ignored"
                                style="
                                    display: none;
                                    font-size: 10px;
                                    padding: 6px 12px;
                                "
                            >
                                <span class="btn-icon">üëÅÔ∏è</span>
                                Manage Ignored Tasks
                            </button>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div
                        class="loading-state"
                        id="prediction-loading"
                        style="display: none"
                    >
                        <div class="loading-spinner"></div>
                        <span class="loading-text"
                            >Generating smart schedule...</span
                        >
                    </div>

                    <!-- Error State -->
                    <div
                        class="error-message"
                        id="prediction-error"
                        style="display: none"
                    >
                        <span class="error-icon">‚ö†Ô∏è</span>
                        <span class="error-text"></span>
                    </div>

                    <!-- Algorithm Info -->
                    <div class="form-section">
                        <details class="algorithm-info">
                            <summary class="info-summary">
                                How does the algorithm work?
                            </summary>
                            <div class="info-content">
                                <h4>üèóÔ∏è System Architecture</h4>
                                <p>
                                    The TakeUforward GitHub Bridge extension implements a sophisticated task scheduling system
                                    with persistent storage, dynamic filtering, and intelligent algorithm-based recommendations.
                                </p>

                                <h4>üìä Data Pipeline</h4>
                                <ul class="info-list">
                                    <li>
                                        <strong>Data Source:</strong> <code>data.json</code> contains problem metadata with
                                        <code>name</code>, <code>difficulty</code>, <code>solved</code> status, and new properties:
                                        <code>grandparent</code>, <code>parent_topic</code>, <code>problem_link</code>
                                    </li>
                                    <li>
                                        <strong>Loading:</strong> <code>popup.js</code> fetches <code>../data.json</code> via
                                        <code>fetch()</code> and loads <code>prediction.js</code> dynamically
                                    </li>
                                    <li>
                                        <strong>Persistence:</strong> User preferences and generated schedules saved to
                                        <code>chrome.storage.local</code>
                                    </li>
                                </ul>

                                <h4>üéØ Prediction Algorithm (<code>scheduleToday()</code>)</h4>
                                <p>The core algorithm implements a dual-queue system with priority-based scheduling:</p>

                                <h5>Queue A: New Problems (FIFO)</h5>
                                <ul class="info-list">
                                    <li>Filters unsolved problems: <code>task.solved.value === false && !task.ignored</code></li>
                                    <li>Maintains strict chronological order from <code>data.json</code></li>
                                    <li>Applies category filters: <code>grandparent</code> and <code>parent_topic</code></li>
                                </ul>

                                <h5>Queue B: Revision Problems (Priority Queue)</h5>
                                <ul class="info-list">
                                    <li>Uses <code>MaxHeap</code> for O(log n) priority operations</li>
                                    <li>Calculates revision score: <code>scoreRevision(nowMs, task)</code></li>
                                    <li>Score formula: <code>0.5 √ó A + 0.3 √ó T + 0.2 √ó D + Œµ</code></li>
                                    <li>Where:
                                        <ul>
                                            <li><code>A = clamp(ageDays / 30)</code> - Recency (0-30 days normalized)</li>
                                            <li><code>T = clamp(tries / 5)</code> - Attempts (0-5 tries normalized)</li>
                                            <li><code>D = clamp(difficulty / 2)</code> - Difficulty (0-2 scale)</li>
                                            <li><code>Œµ</code> - Small random noise for tie-breaking</li>
                                        </ul>
                                    </li>
                                </ul>

                                <h4>‚öñÔ∏è Focus Mode Distribution</h4>
                                <p><code>splitQuota(N, mode)</code> allocates tasks between revision and new problems:</p>
                                <ul class="info-list">
                                    <li><strong>Only Revise (0):</strong> <code>{rev: N, new: 0}</code></li>
                                    <li><strong>Focus Revision (1):</strong> <code>{rev: 0.7N, new: 0.3N}</code></li>
                                    <li><strong>Focus New (2):</strong> <code>{rev: 0.3N, new: 0.7N}</code></li>
                                    <li><strong>Only New (3):</strong> <code>{rev: 0, new: N}</code></li>
                                </ul>

                                <h4>üîÑ Scheduling Logic</h4>
                                <ol class="info-list">
                                    <li>Fill revision quota from priority queue (highest scores first)</li>
                                    <li>Fill new problems quota from FIFO queue (chronological order)</li>
                                    <li>If under target, fill remaining with new problems (maintain FIFO)</li>
                                    <li>If still under target, fill remaining with revision problems</li>
                                </ol>

                                <h4>üéõÔ∏è Dynamic Filtering System</h4>
                                <ul class="info-list">
                                    <li>
                                        <strong>Multi-select Grandparent:</strong> Array-based filtering with
                                        <code>grandparent.includes(task.grandparent)</code>
                                    </li>
                                    <li>
                                        <strong>Parent Topic Cascade:</strong> <code>updateParentTopicOptions()</code>
                                        dynamically populates based on selected grandparents
                                    </li>
                                    <li>
                                        <strong>Real-time Updates:</strong> Filter changes trigger immediate
                                        parent topic list regeneration
                                    </li>
                                </ul>

                                <h4>üíæ Persistence & State Management</h4>
                                <ul class="info-list">
                                    <li>
                                        <strong>Schedule Storage:</strong> Generated schedules saved with metadata
                                        (timestamp, filters, settings) to <code>chrome.storage.local</code>
                                    </li>
                                    <li>
                                        <strong>Auto-restore:</strong> <code>loadScheduledTasks()</code> restores
                                        previous session's schedule on popup load
                                    </li>
                                    <li>
                                        <strong>Ignore Status:</strong> User exclusions persisted across sessions
                                    </li>
                                    <li>
                                        <strong>Settings Memory:</strong> Target count, focus mode, and filter
                                        selections automatically restored
                                    </li>
                                </ul>

                                <h4>üîó Integration Features</h4>
                                <ul class="info-list">
                                    <li>
                                        <strong>Problem Links:</strong> Direct LeetCode/problem links via
                                        <code>task.problem_link</code> with üîó icon
                                    </li>
                                    <li>
                                        <strong>Visual Feedback:</strong> Timestamp indicators show schedule freshness
                                        ("generated 2h 15m ago")
                                    </li>
                                    <li>
                                        <strong>Smart Buttons:</strong> "Generate Schedule" ‚Üí "Update Schedule" when
                                        saved schedule exists
                                    </li>
                                </ul>

                                <h4>‚ö° Performance Optimizations</h4>
                                <ul class="info-list">
                                    <li><strong>Heap Operations:</strong> O(log n) for priority queue insertions/extractions</li>
                                    <li><strong>Linear Filtering:</strong> O(n) single-pass filtering with early termination</li>
                                    <li><strong>Lazy Loading:</strong> Prediction script loaded only when needed</li>
                                    <li><strong>Debounced Updates:</strong> Filter changes trigger efficient UI updates</li>
                                </ul>
                            </div>
                        </details>
                    </div>

                    <!-- Ignored Tasks Management Modal -->
                    <div
                        class="form-section"
                        id="ignored-tasks-section"
                        style="display: none"
                    >
                        <h3 class="section-title">
                            <span class="title-icon">üëÅÔ∏è</span>
                            Ignored Tasks
                        </h3>
                        <div
                            class="ignored-tasks-list"
                            id="ignored-tasks-list"
                            style="max-height: 200px; overflow-y: auto"
                        >
                            <!-- Ignored tasks will be populated here -->
                        </div>
                        <div style="margin-top: 12px">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                id="close-ignored"
                                style="font-size: 10px; padding: 6px 12px"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Help Tab -->
            <section class="tab-content" id="help-tab">
                <div class="help-section">
                    <div class="help-card">
                        <h3 class="help-title">Quick Setup</h3>
                        <ol class="help-steps">
                            <li>
                                Create a GitHub repository for your solutions
                            </li>
                            <li>
                                Generate a personal access token with repo
                                permissions
                            </li>
                            <li>
                                Enter your credentials in the Configuration tab
                            </li>
                            <li>
                                (Optional) Enable Notion tracking and add
                                integration token
                            </li>
                            <li>Test the connection to verify setup</li>
                            <li>Start solving problems on TakeUforward!</li>
                        </ol>
                    </div>

                    <div class="help-card">
                        <h3 class="help-title">Troubleshooting</h3>
                        <div class="help-content">
                            <details class="help-detail">
                                <summary>Token not working?</summary>
                                <p>
                                    Ensure your token has <code>repo</code> and
                                    <code>workflow</code> permissions. Check if
                                    the token is expired.
                                </p>
                            </details>
                            <details class="help-detail">
                                <summary>Repository not found?</summary>
                                <p>
                                    Verify the repository exists and you have
                                    push access. Check the username and
                                    repository name spelling.
                                </p>
                            </details>
                            <details class="help-detail">
                                <summary>Solutions not syncing?</summary>
                                <p>
                                    Check the Status tab for connection issues.
                                    Ensure you're logged into TakeUforward.
                                </p>
                            </details>
                            <details class="help-detail">
                                <summary>How to set up Notion?</summary>
                                <p>
                                    Create a Notion integration at
                                    <code>notion.so/my-integrations</code>, copy
                                    the token, and enable Notion tracking. The
                                    database will be created automatically.
                                </p>
                            </details>
                        </div>
                    </div>

                    <div class="help-card">
                        <h3 class="help-title">Support</h3>
                        <div class="support-section">
                            <p class="support-description">
                                Help us improve this extension by starring the
                                repository on GitHub.
                            </p>
                            <a
                                href="https://github.com/lqSky7/TakeUforwardToGithub"
                                target="_blank"
                                class="support-link"
                            >
                                <span class="support-text"
                                    >Star the repository</span
                                >
                                <span class="support-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <div class="footer-info">
                    <span class="version">v2.0.0</span>
                    <span class="separator">‚Ä¢</span>
                    <span class="privacy">Privacy: Local storage only</span>
                </div>
            </footer>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay hidden" id="loading-overlay">
            <div class="loading-spinner"></div>
            <span class="loading-text">Connecting...</span>
        </div>

        <script src="popup.js"></script>
    </body>
</html>
